<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>失眠</title>
    <link href="/2022/04/15/%E5%A4%B1%E7%9C%A0/"/>
    <url>/2022/04/15/%E5%A4%B1%E7%9C%A0/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="d187599ab7cfd64bdec86a292c2f867a99ecf512c0c2823728f979543dd96d05">ebe6d89f5c9519161c08ef41abf20bafa7bbb9213cb81a639f9df3508aa9beb17ef2d2ebefde0a3e397dacaa25748f9b00a5ca8d4f28df0ed049e05fec2762e36d339c51271c75952b5193b1876b8da126eee49bc416673e7603002eeeae78010a2c365a5b382f341fddf99716c3ab6ece280547e1d9c2d28d3c3d37a3c7394ac0fbf5db803712b7adcc93f98654da7d30dd952d2df90ff706b73e242f1f699c93fd9f3f044a3ee4f39eaa006fa1c4b14b455bc2c46fd3876c4297ddf19ac2002b3b70ece89c09dfef4c5047b87ccc926732c5e5a2c89ba65a7fdd8fa97c3fd3430a0d1b3a181bbc2438daec3fc77d4335694464780fdf6b1fad7561f0d35e71cd53e7e1acc03c29773a7c3356930bbe9994c60d761afe4266b2af0377761d8d4b89018e84bcd4fc3aaf18a31271785698f18b274dc846b67653bd0027bf142b2dde696ef8954910d13a019b51aef8a43080d6cf344f39401a6459ef4eefd682f9beace5f271719dfef98049b54922c7ea0cafd67d135b9fa84d8ed14161022aaddf952fa7f72059c622c0a806347d666da43c5df077ab43e51ca3ed61dab712060f8ece480e0ea087101922abe7941da22c36e22f48399da9cb87e347d369d228e14e05b1c7158091215d812df1499716e437a18d391bbfd5aa0f3726950bebda88b413085dc084830f893a2ae26b267e9fe2f9d917d380d14e85df4cd9b40c7165c0601da057427d22340672dcd512d4f59f2f4d48c34e9ae06582a451ae4f41c261fa055291250e09854520183fd8e0c645d7a2bc4cb1e11faea72d7023f3e4643738837161238626d83fbee3ffbb98ddfd8b6fb0e1b3bc7e0d74fa993005bb7c859b52b2ac4ca814154be5aa70c151bdc9d2d66b6960a27cd1e364cd012c2e40175840f00a3c4179fe78719b5a5fa152b44fc8bcf97e65e807234a51d3a5c13b3c92badb56431e567cc3010037fe3e7f0f08ab61ac8805a5235cb8f5b27b86b885e046d5bd958c4d29f3cbf0e78057b94cd8300f0e8f41e7e9dc641a9b1fe584dc2153d5536c25fc3e2eb555332ed00543d6b8d7ce4bff3052d3e26ac0612e2292315fc06858685d108c8e8acfe7fa63bc4277cadcfcb2809ab4a1f6ecbb15b020e572b18c461b4302e7e08ee100cdc72e3919c316ef28b43c099d31230d1807e54e5359d485a0474de2b18538b6bf48c4dd5821b0243929045509dc3e996beb1cf393f326f7e783f2164660319301f4c912c454c6fba324e901f490d56d11544509c9b61fc4d359b548a654ea000900bc2ed1ce43564b0553d62a74b96a3e77a482855d7370cd7ea3779f1f7d590d75e1db804ba8fd5e3e725d38fe845dd41e28920e6d87b7f22953c265bc5ab80382f063459f6e9c59ed39ad196f7b19d9ed2adebd4955b0c2e91af0a3221aa8c5e21215cf57d21b03901ee754bd4b65ca43c5c2833c820c14f9205661efb08de9795b9d0736fb742999689bb466140c4ae7eee2bdc32c6125c5dda2749e64ac7908f1076bb6c764b4ff5b7e257ded7fd32ef69aff60718a45a8d49643f98d1e778059b52cbb13f0e05eaf21f50ecb3d6babaab9a953eb81ba12049e6831ddf5ed912830508ad41ae4e2e1d0f2b2e2a37a8142ca83f7ab58f96f9aa4d0fe6a1267c2d0f58107acb3e6f47b309a5bc17c0c8b898a749d4d40c5241bbb6e2fa35c12d2a9859699092a8db5d1f6382594313c7e981a6ade5f1d3c056e55d8eb39af582d8de3509477a75b1778dc5fdf6d7d0886c39260e9fd8542efd87ebe0981ef4e22a95a794dc3855635531da15a6990212c2845b44bcfade9f2623bbb78e75a013b3c30c7b2812b9e0f3ede1fedf7ca790fa9134b2d8ed85b27c3edafbbb4714c213a9805016adc50037274c19f971fc1e1affef0b310340b5d244566153c001a111f2b6a1b4709a52167de5893ab8a10af85b451ce958f50f4b3ce143e27651d9d932c245a3fbc7e5b919b6e474ca2e11438758dfc8a9399e8f9992b113b1837e3d3e9ece293d98f72d1590ec7462b434b0f33472f91d7ef8b810ed254c8b22888927a8f03cf9bfc49e6a521a24fe88e3586dcd49490bfc3041c4d1e18cfbad9cd6126f2199d977594d46212e94ec6d9474d202b8402a3f4867524e2e6d583f34a2e8284107b5ea508fc1428a60b97f27337bd68ca24103b745f318d675444f91b49fc44eb36b5b42f0c0505712a087114b4c70da1b543e3d2b8e84ffc56e05c5f4b86036b7676bfaa0a8512bc607b2385cf36295ead61c2d34bf8e5cc97342a416e2d6b0f5791d97de091e55c2aa6355fe0431f99900fe27c63b9544e464391c5a4f8cd639629bb3b76677a04a1c9a2e0ae01e14c1951829c2d2d12bb09068cdc15fd065ced6f603e0b9f8e86a6f63e45ae79b0b87c653cb1ab6b3ebbcdeb9db57819a41c6bc8e34e8202abd9a5e5ede4b78648095298681a65ace2274395279db228e379d2650f5f698a1f381f655d2f23c3f81e9541cdbaeeaafa7106ba45371e81d851dc24f17c0d474a0547bc928d3535d88a516ab3542fa4498cbcc43830852c4b1a07f236a97d7c52bd6dbb997896c1b3329665b22a219e706ca9307aa94b3fb13ab4804da0a589cdbc1220608e22ee35ca136b94861857ced512a451fd9d23edfc7da9bf527b4ed1d2a66b48b1f0ddc4ec0ab5abf33f39e35e2513b9724a666a90760049d174ec9a5fbab4f73a51edc7f938565bad4a9deedb5ccc5b4fd2969f258f9c9ba505c3da81c0bc8e34666660891646defebd8f7d782f5393f9f0deb5524ed1dcccad9580dedfc4959e93c6918ad1d19875dce19689f5a5ff9d84b83b676337693cc6a6584dcbe94873e2c94551aaceb4d2c73ba5fa82de2bf415c4c7d984177a1134a8ac03ad65860e9d78c967b7b5446e50346ece22fc4bfd1ff9ba163b65a43815a9660f1ff83c321fe10418174f417417a32bc22c51249e6b51a9cfbda39792dde8ec758bd6166ad3424365a95b6f4e86bfe6165df774c76ac9006ce661673d09cd3592ec7e6a57c4dca0e3f1b9000c2ecdb347986574661d33ff5ac8736502a46f92d234db6123d6fa08d04e1ab8d899156ba431c842e45b4f61728c2547d471b1748e9250bbbf7db1eb56f33090b5065b60a3fda03822dd984c98068ee960897a852cf20791510f9d17ede56a058cf70ce3eedffd88f49b1eba50cf85e61e43721bf525406709bd2bf20f3f41968d708f0eaa0de8896f6ac5419ad23b0a3667d76fce6514fe0da174ee6cc250871e3eace9d1ec0670a9384fb37a3948163943bdabcb76c0738b631ef01b8a3f9facecfbad84be0bbf81edb98f57c009750dfe50f77f4c3d2137c7c0b45bd5bdc0728439461f424526ba5665cc07714f1ae9341d5769f2426a479714ad8041d024063fb6e4d8a19192ecbe402e2da17f3d8213a1e21840c8f189b82b989bc30a85c9154131db010b7c362890ffcfe990584c23939a99d9d87e4fbc821896408eb3bd0b85788f3c55</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>生活琐事</category>
      
    </categories>
    
    
    <tags>
      
      <tag>生活琐事</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shiro反序列化漏洞复现</title>
    <link href="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <url>/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="shiro反序列化漏洞复现"><a href="#shiro反序列化漏洞复现" class="headerlink" title="shiro反序列化漏洞复现"></a>shiro反序列化漏洞复现</h1><p>Apache Shiro是一个强大且易用的Java安全框架,执行身份验证、授权、密码和会话管理。</p><p><strong>工 作 原 理</strong></p><p>Apache Shiro框架提供了记住我的功能（RememberMe），用户登陆成功后会生成经过加密并编码的cookie。cookie的key为RememberMe，cookie的值是经过对相关信息进行序列化，然后使用aes加密，最后在使用base64编码处理形成的。</p><p>Shiro记住用户会话功能的逻辑如下：</p><p>获取RememberMe的值 —&gt; Base64解密 —&gt; ASE解密 –&gt; 反序列化</p><p>在服务端接收cookie值时，按照如下步骤来解析处理：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>、检索RememberMe cookie 的值<br><span class="hljs-number">2</span>、Base <span class="hljs-number">64</span>解码<br><span class="hljs-number">3</span>、使用AES解密(加密密钥硬编码)<br><span class="hljs-number">4</span>、进行反序列化操作（未作过滤处理）<br>在调用反序列化时未进行任何过滤，导致可以触发远程代码执行漏洞。<br></code></pre></td></tr></table></figure><p><strong>漏 洞 原 理</strong></p><p>因为在反序列化时,不会对其进行过滤,所以如果传入恶意代码将会造成安全问题 在 1.2.4 版本前,是默认ASE秘钥,Key: kPH+bIxk5D2deZiIxcaaaA==,可以直接反序列化执行恶意代码 而在1.2.4之后,ASE秘钥就不为默认了,需要获取到Key才可以进行渗透。</p><p><strong>漏 洞 复 现</strong></p><p>使用vulhub靶场</p><p>启动漏洞环境：</p><p>进入特定漏洞地目录，然后执行</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo docker-compose up -d</span><br></code></pre></td></tr></table></figure><p>然后等待一会儿就好了~比如像下图这样</p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/clipboard.png" alt="img"></p><p>访问<a href="http://192.168.56.132:8080/%E6%AD%A3%E5%B8%B8%E7%99%BB%E9%99%86">http://192.168.56.132:8080/正常登陆</a></p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906154425847.png" alt="image-20210906154425847"></p><p>使用burp进行抓包，查看返回包</p><ul><li>响应包中出现&lt;rememberMe=deleteMe&gt;可以用来大概判断是否使用了Shiro</li></ul><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906155015344.png" alt="image-20210906155015344"></p><p>使用工具爆破密钥以及利用链，可以命令执行，以及注入内存马。</p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906193607965.png" alt="image-20210906193607965"></p><p>vps监听本地端口</p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906194501623.png" alt="image-20210906194501623"></p><p>利用工具可以进行反弹shell</p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906194057296.png"></p><p>反弹成功</p><p><img src="/2022/04/14/shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/image-20210906194749015.png" alt="image-20210906194749015"></p>]]></content>
    
    
    <categories>
      
      <category>安全笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>安全笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
